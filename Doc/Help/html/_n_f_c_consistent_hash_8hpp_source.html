<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ArkGameFrame: NFCConsistentHash.hpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ArkGameFrame.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ArkGameFrame
   &#160;<span id="projectnumber">v0.1.1</span>
   </div>
   <div id="projectbrief">ArkGameFraime is a lightweight, fast, scalable, distributed module and plugin framework to create a game server easily. Greatly inspired by OGRE and Bigworld.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_7a06c62105c5affe7ed07b0b42060f70.html">Frame</a></li><li class="navelem"><a class="el" href="dir_e8e2e8cd2e9cce0e00a01e88b353c0f0.html">NFComm</a></li><li class="navelem"><a class="el" href="dir_134fe9bf93b8508b01ec5bdc93793970.html">NFCore</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">NFCConsistentHash.hpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_n_f_c_consistent_hash_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// -------------------------------------------------------------------------</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//    @FileName         :    NFCConsistentHash.hpp</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">//    @Author           :    LvSheng.Huang</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">//    @Date             :    2012-03-01</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">//    @Module           :    NFCConsistentHash.hpp</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// -------------------------------------------------------------------------</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#ifndef NFC_CONSISTENT_HASH_H</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#define NFC_CONSISTENT_HASH_H</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;string&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &lt;list&gt;</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &lt;functional&gt;</span> </div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="_n_f_platform_8h.html">NFComm/NFPluginModule/NFPlatform.h</a>&quot;</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;common/crc32.hpp&quot;</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="class_n_f_i_virtual_node.html">   28</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_n_f_i_virtual_node.html">NFIVirtualNode</a> </div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="class_n_f_i_virtual_node.html#a532515f6df4ede5591a4ccc9f9201adc">   43</a></span>&#160;    <a class="code" href="class_n_f_i_virtual_node.html#a532515f6df4ede5591a4ccc9f9201adc">NFIVirtualNode</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> nVirID)</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        :<a class="code" href="class_n_f_i_virtual_node.html#a9793e082108078ed86840bc1a5f11ce5">nVirtualIndex</a>(nVirID)</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    {</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    }</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="class_n_f_i_virtual_node.html#a56adb0a73e6fc4882a653f8e19b66d53">   58</a></span>&#160;    <a class="code" href="class_n_f_i_virtual_node.html#a56adb0a73e6fc4882a653f8e19b66d53">NFIVirtualNode</a>()</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    {</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <a class="code" href="class_n_f_i_virtual_node.html#a9793e082108078ed86840bc1a5f11ce5">nVirtualIndex</a> = 0;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    }</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="class_n_f_i_virtual_node.html#a9b3af0cbb1cf10a84873a25cbe89e9ac">   72</a></span>&#160;    <span class="keyword">virtual</span> <a class="code" href="class_n_f_i_virtual_node.html#a9b3af0cbb1cf10a84873a25cbe89e9ac">~NFIVirtualNode</a>()</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    {</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <a class="code" href="class_n_f_i_virtual_node.html#a9793e082108078ed86840bc1a5f11ce5">nVirtualIndex</a> = 0;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    }</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="class_n_f_i_virtual_node.html#a89e93cfe9117bf5d0a300c15e614d0fa">   88</a></span>&#160;    <span class="keyword">virtual</span> std::string <a class="code" href="class_n_f_i_virtual_node.html#a89e93cfe9117bf5d0a300c15e614d0fa">GetDataStr</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    }</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div><div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="class_n_f_i_virtual_node.html#a2eb3cf5759a4f598137abd590d9398fa">  104</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="class_n_f_i_virtual_node.html#a2eb3cf5759a4f598137abd590d9398fa">GetDataID</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        <span class="keywordflow">return</span> 0;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    }</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div><div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="class_n_f_i_virtual_node.html#a986d41eb2eb7968fe5895f0818d248f5">  120</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_n_f_i_virtual_node.html#a986d41eb2eb7968fe5895f0818d248f5">Candidate</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    };</div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div><div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="class_n_f_i_virtual_node.html#aeda1b40afb2f78d6c5cf8c2a1349a41a">  136</a></span>&#160;    std::string <a class="code" href="class_n_f_i_virtual_node.html#aeda1b40afb2f78d6c5cf8c2a1349a41a">ToStr</a>()<span class="keyword"> const </span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        std::ostringstream strInfo;</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        strInfo &lt;&lt; AF_LEXICAL_CAST&lt;std::string&gt;(<a class="code" href="class_n_f_i_virtual_node.html#a2eb3cf5759a4f598137abd590d9398fa">GetDataID</a>()) &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; <a class="code" href="class_n_f_i_virtual_node.html#a89e93cfe9117bf5d0a300c15e614d0fa">GetDataStr</a>() &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; <a class="code" href="class_n_f_i_virtual_node.html#a9793e082108078ed86840bc1a5f11ce5">nVirtualIndex</a>;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="keywordflow">return</span> strInfo.str();</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">//return boost::str(boost::format(&quot;%1%-%2%-%3%&quot;) % AF_LEXICAL_CAST&lt;std::string&gt;(GetDataID()) % GetDataStr() % nVirtualIndex);</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="class_n_f_i_virtual_node.html#a9793e082108078ed86840bc1a5f11ce5">  146</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="class_n_f_i_virtual_node.html#a9793e082108078ed86840bc1a5f11ce5">nVirtualIndex</a>;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;};</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="class_n_f_c_machine_node.html">  158</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a> : <span class="keyword">public</span> <a class="code" href="class_n_f_i_virtual_node.html">NFIVirtualNode</a></div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;{</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="class_n_f_c_machine_node.html#aee0365d8448b2f3b8679fb090b9b2d69">  173</a></span>&#160;    <a class="code" href="class_n_f_c_machine_node.html#aee0365d8448b2f3b8679fb090b9b2d69">NFCMachineNode</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> nVirID) : <a class="code" href="class_n_f_i_virtual_node.html">NFIVirtualNode</a>(nVirID)</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    {</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        strIP = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;        nPort = 0;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        nWeight = 0;<span class="comment">//总共多少权重即是多少虚拟节点         nMachineID = 0;
        bCandidate = false;
    }

    /**
     * @fn  NFCMachineNode::NFCMachineNode()
     *
     * @brief   Default constructor.
     *
     * @author  flyicegood
     * @date    2016/11/29
     */

    NFCMachineNode()
    {
        strIP = &quot;&quot;;
        nPort = 0;
        nWeight = 0;//总共多少权重即是多少虚拟节点
        nMachineID = 0;
        bCandidate = false;
    }

public:

    /**
     * @fn  virtual std::string NFCMachineNode::GetDataStr() const
     *
     * @brief   Gets data string.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  The data string.
     */

    virtual std::string GetDataStr() const 
    {
        return strIP;
    }

    /**
     * @fn  virtual int NFCMachineNode::GetDataID() const
     *
     * @brief   Gets data identifier.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  The data identifier.
     */

    virtual int GetDataID() const
    {
        return nMachineID;
    }

    /**
     * @fn  virtual bool NFCMachineNode::Candidate() const
     *
     * @brief   Queries if we candidate.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool Candidate() const
    {
        return bCandidate;
    }

    /** @brief   The IP. */
    std::string strIP;
    /** @brief   The port. */
    int nPort;
    /** @brief   The weight. */
    int nWeight;
    /** @brief   Identifier for the machine. */
    int nMachineID;
    /** @brief   True to candidate. */
    bool bCandidate;

    /** @brief   如果是候选主机，则在没启用之前，他会指向真实主机. */
    std::list&lt;NFIVirtualNode&gt; xRealMachine;
};

/**
 * @class   NFIHasher
 *
 * @brief   A nfi hasher.
 *
 * @author  flyicegood
 * @date    2016/11/29
 */

class NFIHasher
{
public:

    /**
     * @fn  virtual uint32_t NFIHasher::GetHashValue(const NFIVirtualNode&amp; vNode) = 0;
     *
     * @brief   Gets hash value.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   vNode   The node.
     *
     * @return  The hash value.
     */

    virtual uint32_t GetHashValue(const NFIVirtualNode&amp; vNode) = 0;
};

/**
 * @class   NFCHasher
 *
 * @brief   A nfc hasher.
 *
 * @author  flyicegood
 * @date    2016/11/29
 */

class NFCHasher : public NFIHasher
{
public:

    /**
     * @fn  virtual uint32_t NFCHasher::GetHashValue(const NFIVirtualNode&amp; vNode)
     *
     * @brief   Gets hash value.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   vNode   The node.
     *
     * @return  The hash value.
     */

    virtual uint32_t GetHashValue(const NFIVirtualNode&amp; vNode)
    {
        //boost::crc_32_type ret;
        //std::string vnode = vNode.ToStr();
        //ret.process_bytes(vnode.c_str(), vnode.size());
        
        //return ret.checksum();

        std::string vnode = vNode.ToStr();
        return NFrame::CRC32(vnode);
    }
};

/**
 * @class   NFIConsistentHash
 *
 * @brief   A nfi consistent hash.
 *
 * @author  flyicegood
 * @date    2016/11/29
 */

class NFIConsistentHash
{
    /**
     * @fn  virtual std::size_t NFIConsistentHash::Size() const = 0;
     *
     * @brief   Gets the size.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  A std::size_t.
     */

    virtual std::size_t Size() const = 0;

    /**
     * @fn  virtual bool NFIConsistentHash::Empty() const = 0;
     *
     * @brief   Empties this object.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool Empty() const = 0;

    /**
     * @fn  virtual void NFIConsistentHash::Insert(const int nID, const std::string&amp; strIP, int nPort) = 0;
     *
     * @brief   Inserts.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   nID     The identifier.
     * @param   strIP   The IP.
     * @param   nPort   The port.
     */

    virtual void Insert(const int nID, const std::string&amp; strIP, int nPort) = 0;

    /**
     * @fn  virtual void NFIConsistentHash::Insert(const NFCMachineNode&amp; xNode) = 0;
     *
     * @brief   Inserts the given x coordinate node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   xNode   The node.
     */

    virtual void Insert(const NFCMachineNode&amp; xNode) = 0;

    /**
     * @fn  virtual bool NFIConsistentHash::Exist(const NFCMachineNode&amp; xInNode) = 0;
     *
     * @brief   Exists the given x coordinate in node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   xInNode The in node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool Exist(const NFCMachineNode&amp; xInNode) = 0;

    /**
     * @fn  virtual std::size_t NFIConsistentHash::Erase(const NFCMachineNode&amp; xNode) = 0;
     *
     * @brief   Erases the given x coordinate node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   xNode   The node.
     *
     * @return  A std::size_t.
     */

    virtual std::size_t Erase(const NFCMachineNode&amp; xNode)  = 0;

    /**
     * @fn  virtual bool NFIConsistentHash::GetSuitNode(NFCMachineNode&amp; node) = 0;
     *
     * @brief   Gets suit node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param [in,out]  node    The node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool GetSuitNode(NFCMachineNode&amp; node) = 0;

    /**
     * @fn  virtual bool NFIConsistentHash::GetSuitNode(const std::string&amp; str, NFCMachineNode&amp; node) = 0;
     *
     * @brief   Gets suit node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param           str     The string.
     * @param [in,out]  node    The node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool GetSuitNode(const std::string&amp; str, NFCMachineNode&amp; node) = 0;

    /**
     * @fn  virtual bool NFIConsistentHash::GetSuitNode(uint32_t hashValue, NFCMachineNode&amp; node) = 0;
     *
     * @brief   Gets suit node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param           hashValue   The hash value.
     * @param [in,out]  node        The node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool GetSuitNode(uint32_t hashValue, NFCMachineNode&amp; node) = 0;

    /**
     * @fn  virtual bool NFIConsistentHash::GetNodeList(std::list&lt;NFCMachineNode&gt;&amp; nodeList) = 0;
     *
     * @brief   Gets node list.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param [in,out]  nodeList    List of nodes.
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool GetNodeList(std::list&lt;NFCMachineNode&gt;&amp; nodeList) = 0;
};

/**
 * @class   NFCConsistentHash
 *
 * @brief   A nfc consistent hash.
 *
 * @author  flyicegood
 * @date    2016/11/29
 */

class NFCConsistentHash
{
public:

public:

    /**
     * @fn  NFCConsistentHash::NFCConsistentHash()
     *
     * @brief   Default constructor.
     *
     * @author  flyicegood
     * @date    2016/11/29
     */

    NFCConsistentHash()
    {
        m_pHasher = new NFCHasher();
    }

    /**
     * @fn  virtual NFCConsistentHash::~NFCConsistentHash()
     *
     * @brief   Destructor.
     *
     * @author  flyicegood
     * @date    2016/11/29
     */

    virtual ~NFCConsistentHash()
    {
        delete m_pHasher;
        m_pHasher = NULL;
    }

public:

    /**
     * @fn  std::size_t NFCConsistentHash::Size() const
     *
     * @brief   Gets the size.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  A std::size_t.
     */

    std::size_t Size() const
    {
        return mxNodes.size();
    }

    /**
     * @fn  bool NFCConsistentHash::Empty() const
     *
     * @brief   Empties this object.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  True if it succeeds, false if it fails.
     */

    bool Empty() const 
    {
        return mxNodes.empty();
    }

    /**
     * @fn  void NFCConsistentHash::Insert(const int nID, const std::string&amp; strIP, int nPort)
     *
     * @brief   Inserts.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   nID     The identifier.
     * @param   strIP   The IP.
     * @param   nPort   The port.
     */

    void Insert(const int nID, const std::string&amp; strIP, int nPort) 
    {
        NFCMachineNode xNode;
        xNode.nMachineID = nID;
        xNode.strIP = strIP;
        xNode.nPort = nPort;

        Insert(xNode);
    }

    /**
     * @fn  void NFCConsistentHash::Insert(const NFCMachineNode&amp; xNode)
     *
     * @brief   Inserts the given x coordinate node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   xNode   The node.
     */

    void Insert(const NFCMachineNode&amp; xNode) 
    {
        uint32_t hash = m_pHasher-&gt;GetHashValue(xNode);
        auto it = mxNodes.find(hash);
        if (it == mxNodes.end())
        {
            mxNodes.insert(std::map&lt;uint32_t, NFCMachineNode&gt;::value_type(hash, xNode));
        }
    }

    /**
     * @fn  bool NFCConsistentHash::Exist(const NFCMachineNode&amp; xInNode)
     *
     * @brief   Exists the given x coordinate in node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   xInNode The in node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    bool Exist(const NFCMachineNode&amp; xInNode)
    {
        uint32_t hash = m_pHasher-&gt;GetHashValue(xInNode);
        std::map&lt;uint32_t, NFCMachineNode&gt;::iterator it = mxNodes.find(hash);
        if (it != mxNodes.end())
        {
            return true;
        }

        return false;
    }

    /**
     * @fn  std::size_t NFCConsistentHash::Erase(const NFCMachineNode&amp; xNode)
     *
     * @brief   Erases the given x coordinate node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   xNode   The node.
     *
     * @return  A std::size_t.
     */

    std::size_t Erase(const NFCMachineNode&amp; xNode) 
    {
        uint32_t hash = m_pHasher-&gt;GetHashValue(xNode);
        return mxNodes.erase(hash);
    }

    /**
     * @fn  bool NFCConsistentHash::GetSuitNode(NFCMachineNode&amp; node)
     *
     * @brief   Gets suit node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param [in,out]  node    The node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    bool GetSuitNode(NFCMachineNode&amp; node)
    {
        int nID = 0;
        return GetSuitNode(nID, node);
    }

    /**
     * @fn  bool NFCConsistentHash::GetSuitNode(const std::string&amp; str, NFCMachineNode&amp; node)
     *
     * @brief   Gets suit node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param           str     The string.
     * @param [in,out]  node    The node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    bool GetSuitNode(const std::string&amp; str, NFCMachineNode&amp; node)
    {
        uint32_t nCRC32 = NFrame::CRC32(str);
        return GetSuitNode(nCRC32, node);
    }

    /**
     * @fn  bool NFCConsistentHash::GetSuitNode(uint32_t hashValue, NFCMachineNode&amp; node)
     *
     * @brief   Gets suit node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param           hashValue   The hash value.
     * @param [in,out]  node        The node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    bool GetSuitNode(uint32_t hashValue, NFCMachineNode&amp; node)
    {
        if(mxNodes.empty())
        {
            return false;
        }

        std::map&lt;uint32_t, NFCMachineNode&gt;::iterator it = mxNodes.lower_bound(hashValue);

        if (it == mxNodes.end())
        {
            it = mxNodes.begin();
        }

        node = it-&gt;second;

        return true;
    }

    /**
     * @fn  bool NFCConsistentHash::GetNodeList(std::list&lt;NFCMachineNode&gt;&amp; nodeList)
     *
     * @brief   Gets node list.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param [in,out]  nodeList    List of nodes.
     *
     * @return  True if it succeeds, false if it fails.
     */

    bool GetNodeList(std::list&lt;NFCMachineNode&gt;&amp; nodeList)
    {
        for (std::map&lt;uint32_t, NFCMachineNode&gt;::iterator it = mxNodes.begin(); it != mxNodes.end(); ++it)
        {
            nodeList.push_back(it-&gt;second);
        }

        return true;
    }

private:
    /** @brief   The mx nodes. */
    std::map&lt;uint32_t, NFCMachineNode&gt; mxNodes;
    /** @brief   The hasher. */
    NFIHasher* m_pHasher;
};


#endif
</span></div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        nMachineID = 0;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        bCandidate = <span class="keyword">false</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div><div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="class_n_f_c_machine_node.html#a5d485e6eaedec0c0cb31c634b69b15e6">  191</a></span>&#160;    <a class="code" href="class_n_f_c_machine_node.html#a5d485e6eaedec0c0cb31c634b69b15e6">NFCMachineNode</a>()</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    {</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        strIP = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        nPort = 0;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        nWeight = 0;<span class="comment">//总共多少权重即是多少虚拟节点         nMachineID = 0;
        bCandidate = false;
    }

public:

    /**
     * @fn  virtual std::string NFCMachineNode::GetDataStr() const
     *
     * @brief   Gets data string.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  The data string.
     */

    virtual std::string GetDataStr() const 
    {
        return strIP;
    }

    /**
     * @fn  virtual int NFCMachineNode::GetDataID() const
     *
     * @brief   Gets data identifier.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  The data identifier.
     */

    virtual int GetDataID() const
    {
        return nMachineID;
    }

    /**
     * @fn  virtual bool NFCMachineNode::Candidate() const
     *
     * @brief   Queries if we candidate.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool Candidate() const
    {
        return bCandidate;
    }

    /** @brief   The IP. */
    std::string strIP;
    /** @brief   The port. */
    int nPort;
    /** @brief   The weight. */
    int nWeight;
    /** @brief   Identifier for the machine. */
    int nMachineID;
    /** @brief   True to candidate. */
    bool bCandidate;

    /** @brief   如果是候选主机，则在没启用之前，他会指向真实主机. */
    std::list&lt;NFIVirtualNode&gt; xRealMachine;
};

/**
 * @class   NFIHasher
 *
 * @brief   A nfi hasher.
 *
 * @author  flyicegood
 * @date    2016/11/29
 */

class NFIHasher
{
public:

    /**
     * @fn  virtual uint32_t NFIHasher::GetHashValue(const NFIVirtualNode&amp; vNode) = 0;
     *
     * @brief   Gets hash value.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   vNode   The node.
     *
     * @return  The hash value.
     */

    virtual uint32_t GetHashValue(const NFIVirtualNode&amp; vNode) = 0;
};

/**
 * @class   NFCHasher
 *
 * @brief   A nfc hasher.
 *
 * @author  flyicegood
 * @date    2016/11/29
 */

class NFCHasher : public NFIHasher
{
public:

    /**
     * @fn  virtual uint32_t NFCHasher::GetHashValue(const NFIVirtualNode&amp; vNode)
     *
     * @brief   Gets hash value.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   vNode   The node.
     *
     * @return  The hash value.
     */

    virtual uint32_t GetHashValue(const NFIVirtualNode&amp; vNode)
    {
        //boost::crc_32_type ret;
        //std::string vnode = vNode.ToStr();
        //ret.process_bytes(vnode.c_str(), vnode.size());
        
        //return ret.checksum();

        std::string vnode = vNode.ToStr();
        return NFrame::CRC32(vnode);
    }
};

/**
 * @class   NFIConsistentHash
 *
 * @brief   A nfi consistent hash.
 *
 * @author  flyicegood
 * @date    2016/11/29
 */

class NFIConsistentHash
{
    /**
     * @fn  virtual std::size_t NFIConsistentHash::Size() const = 0;
     *
     * @brief   Gets the size.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  A std::size_t.
     */

    virtual std::size_t Size() const = 0;

    /**
     * @fn  virtual bool NFIConsistentHash::Empty() const = 0;
     *
     * @brief   Empties this object.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool Empty() const = 0;

    /**
     * @fn  virtual void NFIConsistentHash::Insert(const int nID, const std::string&amp; strIP, int nPort) = 0;
     *
     * @brief   Inserts.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   nID     The identifier.
     * @param   strIP   The IP.
     * @param   nPort   The port.
     */

    virtual void Insert(const int nID, const std::string&amp; strIP, int nPort) = 0;

    /**
     * @fn  virtual void NFIConsistentHash::Insert(const NFCMachineNode&amp; xNode) = 0;
     *
     * @brief   Inserts the given x coordinate node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   xNode   The node.
     */

    virtual void Insert(const NFCMachineNode&amp; xNode) = 0;

    /**
     * @fn  virtual bool NFIConsistentHash::Exist(const NFCMachineNode&amp; xInNode) = 0;
     *
     * @brief   Exists the given x coordinate in node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   xInNode The in node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool Exist(const NFCMachineNode&amp; xInNode) = 0;

    /**
     * @fn  virtual std::size_t NFIConsistentHash::Erase(const NFCMachineNode&amp; xNode) = 0;
     *
     * @brief   Erases the given x coordinate node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   xNode   The node.
     *
     * @return  A std::size_t.
     */

    virtual std::size_t Erase(const NFCMachineNode&amp; xNode)  = 0;

    /**
     * @fn  virtual bool NFIConsistentHash::GetSuitNode(NFCMachineNode&amp; node) = 0;
     *
     * @brief   Gets suit node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param [in,out]  node    The node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool GetSuitNode(NFCMachineNode&amp; node) = 0;

    /**
     * @fn  virtual bool NFIConsistentHash::GetSuitNode(const std::string&amp; str, NFCMachineNode&amp; node) = 0;
     *
     * @brief   Gets suit node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param           str     The string.
     * @param [in,out]  node    The node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool GetSuitNode(const std::string&amp; str, NFCMachineNode&amp; node) = 0;

    /**
     * @fn  virtual bool NFIConsistentHash::GetSuitNode(uint32_t hashValue, NFCMachineNode&amp; node) = 0;
     *
     * @brief   Gets suit node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param           hashValue   The hash value.
     * @param [in,out]  node        The node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool GetSuitNode(uint32_t hashValue, NFCMachineNode&amp; node) = 0;

    /**
     * @fn  virtual bool NFIConsistentHash::GetNodeList(std::list&lt;NFCMachineNode&gt;&amp; nodeList) = 0;
     *
     * @brief   Gets node list.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param [in,out]  nodeList    List of nodes.
     *
     * @return  True if it succeeds, false if it fails.
     */

    virtual bool GetNodeList(std::list&lt;NFCMachineNode&gt;&amp; nodeList) = 0;
};

/**
 * @class   NFCConsistentHash
 *
 * @brief   A nfc consistent hash.
 *
 * @author  flyicegood
 * @date    2016/11/29
 */

class NFCConsistentHash
{
public:

public:

    /**
     * @fn  NFCConsistentHash::NFCConsistentHash()
     *
     * @brief   Default constructor.
     *
     * @author  flyicegood
     * @date    2016/11/29
     */

    NFCConsistentHash()
    {
        m_pHasher = new NFCHasher();
    }

    /**
     * @fn  virtual NFCConsistentHash::~NFCConsistentHash()
     *
     * @brief   Destructor.
     *
     * @author  flyicegood
     * @date    2016/11/29
     */

    virtual ~NFCConsistentHash()
    {
        delete m_pHasher;
        m_pHasher = NULL;
    }

public:

    /**
     * @fn  std::size_t NFCConsistentHash::Size() const
     *
     * @brief   Gets the size.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  A std::size_t.
     */

    std::size_t Size() const
    {
        return mxNodes.size();
    }

    /**
     * @fn  bool NFCConsistentHash::Empty() const
     *
     * @brief   Empties this object.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @return  True if it succeeds, false if it fails.
     */

    bool Empty() const 
    {
        return mxNodes.empty();
    }

    /**
     * @fn  void NFCConsistentHash::Insert(const int nID, const std::string&amp; strIP, int nPort)
     *
     * @brief   Inserts.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   nID     The identifier.
     * @param   strIP   The IP.
     * @param   nPort   The port.
     */

    void Insert(const int nID, const std::string&amp; strIP, int nPort) 
    {
        NFCMachineNode xNode;
        xNode.nMachineID = nID;
        xNode.strIP = strIP;
        xNode.nPort = nPort;

        Insert(xNode);
    }

    /**
     * @fn  void NFCConsistentHash::Insert(const NFCMachineNode&amp; xNode)
     *
     * @brief   Inserts the given x coordinate node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   xNode   The node.
     */

    void Insert(const NFCMachineNode&amp; xNode) 
    {
        uint32_t hash = m_pHasher-&gt;GetHashValue(xNode);
        auto it = mxNodes.find(hash);
        if (it == mxNodes.end())
        {
            mxNodes.insert(std::map&lt;uint32_t, NFCMachineNode&gt;::value_type(hash, xNode));
        }
    }

    /**
     * @fn  bool NFCConsistentHash::Exist(const NFCMachineNode&amp; xInNode)
     *
     * @brief   Exists the given x coordinate in node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   xInNode The in node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    bool Exist(const NFCMachineNode&amp; xInNode)
    {
        uint32_t hash = m_pHasher-&gt;GetHashValue(xInNode);
        std::map&lt;uint32_t, NFCMachineNode&gt;::iterator it = mxNodes.find(hash);
        if (it != mxNodes.end())
        {
            return true;
        }

        return false;
    }

    /**
     * @fn  std::size_t NFCConsistentHash::Erase(const NFCMachineNode&amp; xNode)
     *
     * @brief   Erases the given x coordinate node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param   xNode   The node.
     *
     * @return  A std::size_t.
     */

    std::size_t Erase(const NFCMachineNode&amp; xNode) 
    {
        uint32_t hash = m_pHasher-&gt;GetHashValue(xNode);
        return mxNodes.erase(hash);
    }

    /**
     * @fn  bool NFCConsistentHash::GetSuitNode(NFCMachineNode&amp; node)
     *
     * @brief   Gets suit node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param [in,out]  node    The node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    bool GetSuitNode(NFCMachineNode&amp; node)
    {
        int nID = 0;
        return GetSuitNode(nID, node);
    }

    /**
     * @fn  bool NFCConsistentHash::GetSuitNode(const std::string&amp; str, NFCMachineNode&amp; node)
     *
     * @brief   Gets suit node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param           str     The string.
     * @param [in,out]  node    The node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    bool GetSuitNode(const std::string&amp; str, NFCMachineNode&amp; node)
    {
        uint32_t nCRC32 = NFrame::CRC32(str);
        return GetSuitNode(nCRC32, node);
    }

    /**
     * @fn  bool NFCConsistentHash::GetSuitNode(uint32_t hashValue, NFCMachineNode&amp; node)
     *
     * @brief   Gets suit node.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param           hashValue   The hash value.
     * @param [in,out]  node        The node.
     *
     * @return  True if it succeeds, false if it fails.
     */

    bool GetSuitNode(uint32_t hashValue, NFCMachineNode&amp; node)
    {
        if(mxNodes.empty())
        {
            return false;
        }

        std::map&lt;uint32_t, NFCMachineNode&gt;::iterator it = mxNodes.lower_bound(hashValue);

        if (it == mxNodes.end())
        {
            it = mxNodes.begin();
        }

        node = it-&gt;second;

        return true;
    }

    /**
     * @fn  bool NFCConsistentHash::GetNodeList(std::list&lt;NFCMachineNode&gt;&amp; nodeList)
     *
     * @brief   Gets node list.
     *
     * @author  flyicegood
     * @date    2016/11/29
     *
     * @param [in,out]  nodeList    List of nodes.
     *
     * @return  True if it succeeds, false if it fails.
     */

    bool GetNodeList(std::list&lt;NFCMachineNode&gt;&amp; nodeList)
    {
        for (std::map&lt;uint32_t, NFCMachineNode&gt;::iterator it = mxNodes.begin(); it != mxNodes.end(); ++it)
        {
            nodeList.push_back(it-&gt;second);
        }

        return true;
    }

private:
    /** @brief   The mx nodes. */
    std::map&lt;uint32_t, NFCMachineNode&gt; mxNodes;
    /** @brief   The hasher. */
    NFIHasher* m_pHasher;
};


#endif
</span></div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        nMachineID = 0;</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        bCandidate = <span class="keyword">false</span>;</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    }</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno"><a class="line" href="class_n_f_c_machine_node.html#a1aac77ad813945f4d11cf2220c904928">  213</a></span>&#160;    <span class="keyword">virtual</span> std::string <a class="code" href="class_n_f_c_machine_node.html#a1aac77ad813945f4d11cf2220c904928">GetDataStr</a>()<span class="keyword"> const </span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">return</span> strIP;</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="class_n_f_c_machine_node.html#adc9f7a10addffbe139e9a4e9c8daa40a">  229</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="class_n_f_c_machine_node.html#adc9f7a10addffbe139e9a4e9c8daa40a">GetDataID</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;        <span class="keywordflow">return</span> nMachineID;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    }</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;</div><div class="line"><a name="l00245"></a><span class="lineno"><a class="line" href="class_n_f_c_machine_node.html#a8e49638992ef66025bb6bc0583ece139">  245</a></span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> <a class="code" href="class_n_f_c_machine_node.html#a8e49638992ef66025bb6bc0583ece139">Candidate</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="keywordflow">return</span> bCandidate;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    }</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="class_n_f_c_machine_node.html#a208a6fae092a594d67df99cb0720d93b">  251</a></span>&#160;    std::string <a class="code" href="class_n_f_c_machine_node.html#a208a6fae092a594d67df99cb0720d93b">strIP</a>;</div><div class="line"><a name="l00253"></a><span class="lineno"><a class="line" href="class_n_f_c_machine_node.html#afd6171a7c12d33b658a56f5a6e29e5f6">  253</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="class_n_f_c_machine_node.html#afd6171a7c12d33b658a56f5a6e29e5f6">nPort</a>;</div><div class="line"><a name="l00255"></a><span class="lineno"><a class="line" href="class_n_f_c_machine_node.html#affba4a0c80decbe4942d7fbd94745a3d">  255</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="class_n_f_c_machine_node.html#affba4a0c80decbe4942d7fbd94745a3d">nWeight</a>;</div><div class="line"><a name="l00257"></a><span class="lineno"><a class="line" href="class_n_f_c_machine_node.html#a1c637e82822f11a47294b75f1cd21e1f">  257</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="class_n_f_c_machine_node.html#a1c637e82822f11a47294b75f1cd21e1f">nMachineID</a>;</div><div class="line"><a name="l00259"></a><span class="lineno"><a class="line" href="class_n_f_c_machine_node.html#a98ef940585ace3ff994ee56d149bcce1">  259</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_n_f_c_machine_node.html#a98ef940585ace3ff994ee56d149bcce1">bCandidate</a>;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;</div><div class="line"><a name="l00262"></a><span class="lineno"><a class="line" href="class_n_f_c_machine_node.html#a0cfaed1390443be688a318a2771a9fe6">  262</a></span>&#160;    std::list&lt;NFIVirtualNode&gt; <a class="code" href="class_n_f_c_machine_node.html#a0cfaed1390443be688a318a2771a9fe6">xRealMachine</a>;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;};</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00274"></a><span class="lineno"><a class="line" href="class_n_f_i_hasher.html">  274</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_n_f_i_hasher.html">NFIHasher</a></div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;{</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <span class="keyword">virtual</span> uint32_t GetHashValue(<span class="keyword">const</span> <a class="code" href="class_n_f_i_virtual_node.html">NFIVirtualNode</a>&amp; vNode) = 0;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;};</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00303"></a><span class="lineno"><a class="line" href="class_n_f_c_hasher.html">  303</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_n_f_c_hasher.html">NFCHasher</a> : <span class="keyword">public</span> <a class="code" href="class_n_f_i_hasher.html">NFIHasher</a></div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;{</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno"><a class="line" href="class_n_f_c_hasher.html#a3e04172d0f1dd6baf11232b0e583d62a">  320</a></span>&#160;    <span class="keyword">virtual</span> uint32_t <a class="code" href="class_n_f_c_hasher.html#a3e04172d0f1dd6baf11232b0e583d62a">GetHashValue</a>(<span class="keyword">const</span> <a class="code" href="class_n_f_i_virtual_node.html">NFIVirtualNode</a>&amp; vNode)</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    {</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="comment">//boost::crc_32_type ret;</span></div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="comment">//std::string vnode = vNode.ToStr();</span></div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="comment">//ret.process_bytes(vnode.c_str(), vnode.size());</span></div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        </div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="comment">//return ret.checksum();</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        std::string vnode = vNode.<a class="code" href="class_n_f_i_virtual_node.html#aeda1b40afb2f78d6c5cf8c2a1349a41a">ToStr</a>();</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;        <span class="keywordflow">return</span> NFrame::CRC32(vnode);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    }</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;};</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div><div class="line"><a name="l00342"></a><span class="lineno"><a class="line" href="class_n_f_i_consistent_hash.html">  342</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_n_f_i_consistent_hash.html">NFIConsistentHash</a></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;{</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keyword">virtual</span> std::size_t Size() <span class="keyword">const</span> = 0;</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> Empty() <span class="keyword">const</span> = 0;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> Insert(<span class="keyword">const</span> <span class="keywordtype">int</span> nID, <span class="keyword">const</span> std::string&amp; strIP, <span class="keywordtype">int</span> nPort) = 0;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">void</span> Insert(<span class="keyword">const</span> <a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a>&amp; xNode) = 0;</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> Exist(<span class="keyword">const</span> <a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a>&amp; xInNode) = 0;</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    <span class="keyword">virtual</span> std::size_t Erase(<span class="keyword">const</span> <a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a>&amp; xNode)  = 0;</div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> GetSuitNode(<a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a>&amp; node) = 0;</div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;</div><div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> GetSuitNode(<span class="keyword">const</span> std::string&amp; str, <a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a>&amp; node) = 0;</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;</div><div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> GetSuitNode(uint32_t hashValue, <a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a>&amp; node) = 0;</div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <span class="keyword">virtual</span> <span class="keywordtype">bool</span> GetNodeList(std::list&lt;NFCMachineNode&gt;&amp; nodeList) = 0;</div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;};</div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div><div class="line"><a name="l00500"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html">  500</a></span>&#160;<span class="keyword">class </span><a class="code" href="class_n_f_c_consistent_hash.html">NFCConsistentHash</a></div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;{</div><div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div><div class="line"><a name="l00515"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#abd5547de3987535f66d0710307ccf587">  515</a></span>&#160;    <a class="code" href="class_n_f_c_consistent_hash.html#abd5547de3987535f66d0710307ccf587">NFCConsistentHash</a>()</div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    {</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;        m_pHasher = <span class="keyword">new</span> <a class="code" href="class_n_f_c_hasher.html">NFCHasher</a>();</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    }</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;</div><div class="line"><a name="l00529"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#a279954e07e28d128baca8fd7bfc6d8fb">  529</a></span>&#160;    <span class="keyword">virtual</span> <a class="code" href="class_n_f_c_consistent_hash.html#a279954e07e28d128baca8fd7bfc6d8fb">~NFCConsistentHash</a>()</div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;    {</div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;        <span class="keyword">delete</span> m_pHasher;</div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;        m_pHasher = NULL;</div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;    }</div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;</div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="keyword">public</span>:</div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;</div><div class="line"><a name="l00548"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#a4030aed0ad64cc6605310c219443733d">  548</a></span>&#160;    std::size_t <a class="code" href="class_n_f_c_consistent_hash.html#a4030aed0ad64cc6605310c219443733d">Size</a>()<span class="keyword"> const</span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;        <span class="keywordflow">return</span> mxNodes.size();</div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    }</div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;</div><div class="line"><a name="l00564"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#a3a78b0fda61127b1007ee7294c0a750d">  564</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_n_f_c_consistent_hash.html#a3a78b0fda61127b1007ee7294c0a750d">Empty</a>()<span class="keyword"> const </span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="keyword">    </span>{</div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="keywordflow">return</span> mxNodes.empty();</div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    }</div><div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;</div><div class="line"><a name="l00582"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#a0d3bbc9f50a26d1cf1830b6cb632b0af">  582</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_n_f_c_consistent_hash.html#a0d3bbc9f50a26d1cf1830b6cb632b0af">Insert</a>(<span class="keyword">const</span> <span class="keywordtype">int</span> nID, <span class="keyword">const</span> std::string&amp; strIP, <span class="keywordtype">int</span> nPort) </div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;    {</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;        <a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a> xNode;</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        xNode.<a class="code" href="class_n_f_c_machine_node.html#a1c637e82822f11a47294b75f1cd21e1f">nMachineID</a> = nID;</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        xNode.<a class="code" href="class_n_f_c_machine_node.html#a208a6fae092a594d67df99cb0720d93b">strIP</a> = strIP;</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;        xNode.<a class="code" href="class_n_f_c_machine_node.html#afd6171a7c12d33b658a56f5a6e29e5f6">nPort</a> = nPort;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        Insert(xNode);</div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;    }</div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;</div><div class="line"><a name="l00603"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#ab81d834827002eea9241c482959ec30b">  603</a></span>&#160;    <span class="keywordtype">void</span> <a class="code" href="class_n_f_c_consistent_hash.html#ab81d834827002eea9241c482959ec30b">Insert</a>(<span class="keyword">const</span> <a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a>&amp; xNode) </div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    {</div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;        uint32_t hash = m_pHasher-&gt;GetHashValue(xNode);</div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="keyword">auto</span> it = mxNodes.find(hash);</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <span class="keywordflow">if</span> (it == mxNodes.end())</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        {</div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            mxNodes.insert(std::map&lt;uint32_t, NFCMachineNode&gt;::value_type(hash, xNode));</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;        }</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    }</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;</div><div class="line"><a name="l00626"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#af67d2d75ffc7c9762cee876c01f911bf">  626</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_n_f_c_consistent_hash.html#af67d2d75ffc7c9762cee876c01f911bf">Exist</a>(<span class="keyword">const</span> <a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a>&amp; xInNode)</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    {</div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        uint32_t hash = m_pHasher-&gt;GetHashValue(xInNode);</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        std::map&lt;uint32_t, NFCMachineNode&gt;::iterator it = mxNodes.find(hash);</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">if</span> (it != mxNodes.end())</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        {</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;        }</div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    }</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div><div class="line"><a name="l00651"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#a0295327d05d39e03a1f26e24d8911933">  651</a></span>&#160;    std::size_t <a class="code" href="class_n_f_c_consistent_hash.html#a0295327d05d39e03a1f26e24d8911933">Erase</a>(<span class="keyword">const</span> <a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a>&amp; xNode) </div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    {</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;        uint32_t hash = m_pHasher-&gt;GetHashValue(xNode);</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;        <span class="keywordflow">return</span> mxNodes.erase(hash);</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    }</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;</div><div class="line"><a name="l00670"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#a0fd8f1af6f3d19fe3bfacaf0455e22b4">  670</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_n_f_c_consistent_hash.html#a0fd8f1af6f3d19fe3bfacaf0455e22b4">GetSuitNode</a>(<a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a>&amp; node)</div><div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    {</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="keywordtype">int</span> nID = 0;</div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">return</span> GetSuitNode(nID, node);</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;    }</div><div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;</div><div class="line"><a name="l00690"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#abeaf9f92e51921c0979bbb39662a20eb">  690</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_n_f_c_consistent_hash.html#abeaf9f92e51921c0979bbb39662a20eb">GetSuitNode</a>(<span class="keyword">const</span> std::string&amp; str, <a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a>&amp; node)</div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    {</div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;        uint32_t nCRC32 = NFrame::CRC32(str);</div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;        <span class="keywordflow">return</span> GetSuitNode(nCRC32, node);</div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    }</div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;</div><div class="line"><a name="l00710"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#a427ac1afe315b5ffdfc2c224682feca3">  710</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_n_f_c_consistent_hash.html#a427ac1afe315b5ffdfc2c224682feca3">GetSuitNode</a>(uint32_t hashValue, <a class="code" href="class_n_f_c_machine_node.html">NFCMachineNode</a>&amp; node)</div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;    {</div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        <span class="keywordflow">if</span>(mxNodes.empty())</div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        {</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        }</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        std::map&lt;uint32_t, NFCMachineNode&gt;::iterator it = mxNodes.lower_bound(hashValue);</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">if</span> (it == mxNodes.end())</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        {</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            it = mxNodes.begin();</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        }</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        node = it-&gt;second;</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    }</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;</div><div class="line"><a name="l00742"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#aa6de4219ac62d07484eaeb5eaf3db99c">  742</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="class_n_f_c_consistent_hash.html#aa6de4219ac62d07484eaeb5eaf3db99c">GetNodeList</a>(std::list&lt;NFCMachineNode&gt;&amp; nodeList)</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;    {</div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <span class="keywordflow">for</span> (std::map&lt;uint32_t, NFCMachineNode&gt;::iterator it = mxNodes.begin(); it != mxNodes.end(); ++it)</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        {</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            nodeList.push_back(it-&gt;second);</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;        }</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    }</div><div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;<span class="keyword">private</span>:</div><div class="line"><a name="l00754"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#afee7f79fd52d1f918f6562701c667dcc">  754</a></span>&#160;    std::map&lt;uint32_t, NFCMachineNode&gt; <a class="code" href="class_n_f_c_consistent_hash.html#afee7f79fd52d1f918f6562701c667dcc">mxNodes</a>;</div><div class="line"><a name="l00756"></a><span class="lineno"><a class="line" href="class_n_f_c_consistent_hash.html#aab3ddfdc96a555eae955a728835fe3d6">  756</a></span>&#160;    <a class="code" href="class_n_f_i_hasher.html">NFIHasher</a>* <a class="code" href="class_n_f_c_consistent_hash.html#aab3ddfdc96a555eae955a728835fe3d6">m_pHasher</a>;</div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;};</div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;</div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="class_n_f_c_consistent_hash_html"><div class="ttname"><a href="class_n_f_c_consistent_hash.html">NFCConsistentHash</a></div><div class="ttdoc">A nfc consistent hash. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:500</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_afee7f79fd52d1f918f6562701c667dcc"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#afee7f79fd52d1f918f6562701c667dcc">NFCConsistentHash::mxNodes</a></div><div class="ttdeci">std::map&lt; uint32_t, NFCMachineNode &gt; mxNodes</div><div class="ttdoc">The mx nodes. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:754</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_a0295327d05d39e03a1f26e24d8911933"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#a0295327d05d39e03a1f26e24d8911933">NFCConsistentHash::Erase</a></div><div class="ttdeci">std::size_t Erase(const NFCMachineNode &amp;xNode)</div><div class="ttdoc">Erases the given x coordinate node. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:651</div></div>
<div class="ttc" id="class_n_f_c_machine_node_html_a1aac77ad813945f4d11cf2220c904928"><div class="ttname"><a href="class_n_f_c_machine_node.html#a1aac77ad813945f4d11cf2220c904928">NFCMachineNode::GetDataStr</a></div><div class="ttdeci">virtual std::string GetDataStr() const</div><div class="ttdoc">Gets data string. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:213</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_a0d3bbc9f50a26d1cf1830b6cb632b0af"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#a0d3bbc9f50a26d1cf1830b6cb632b0af">NFCConsistentHash::Insert</a></div><div class="ttdeci">void Insert(const int nID, const std::string &amp;strIP, int nPort)</div><div class="ttdoc">Inserts. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:582</div></div>
<div class="ttc" id="class_n_f_c_machine_node_html_a0cfaed1390443be688a318a2771a9fe6"><div class="ttname"><a href="class_n_f_c_machine_node.html#a0cfaed1390443be688a318a2771a9fe6">NFCMachineNode::xRealMachine</a></div><div class="ttdeci">std::list&lt; NFIVirtualNode &gt; xRealMachine</div><div class="ttdoc">如果是候选主机，则在没启用之前，他会指向真实主机. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:262</div></div>
<div class="ttc" id="class_n_f_c_machine_node_html_a8e49638992ef66025bb6bc0583ece139"><div class="ttname"><a href="class_n_f_c_machine_node.html#a8e49638992ef66025bb6bc0583ece139">NFCMachineNode::Candidate</a></div><div class="ttdeci">virtual bool Candidate() const</div><div class="ttdoc">Queries if we candidate. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:245</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_abd5547de3987535f66d0710307ccf587"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#abd5547de3987535f66d0710307ccf587">NFCConsistentHash::NFCConsistentHash</a></div><div class="ttdeci">NFCConsistentHash()</div><div class="ttdoc">Default constructor. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:515</div></div>
<div class="ttc" id="class_n_f_i_virtual_node_html"><div class="ttname"><a href="class_n_f_i_virtual_node.html">NFIVirtualNode</a></div><div class="ttdoc">虚拟节点. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:28</div></div>
<div class="ttc" id="class_n_f_i_virtual_node_html_a9793e082108078ed86840bc1a5f11ce5"><div class="ttname"><a href="class_n_f_i_virtual_node.html#a9793e082108078ed86840bc1a5f11ce5">NFIVirtualNode::nVirtualIndex</a></div><div class="ttdeci">int nVirtualIndex</div><div class="ttdoc">虚拟节点序号. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:146</div></div>
<div class="ttc" id="class_n_f_c_machine_node_html_a208a6fae092a594d67df99cb0720d93b"><div class="ttname"><a href="class_n_f_c_machine_node.html#a208a6fae092a594d67df99cb0720d93b">NFCMachineNode::strIP</a></div><div class="ttdeci">std::string strIP</div><div class="ttdoc">The IP. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:251</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_aa6de4219ac62d07484eaeb5eaf3db99c"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#aa6de4219ac62d07484eaeb5eaf3db99c">NFCConsistentHash::GetNodeList</a></div><div class="ttdeci">bool GetNodeList(std::list&lt; NFCMachineNode &gt; &amp;nodeList)</div><div class="ttdoc">Gets node list. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:742</div></div>
<div class="ttc" id="class_n_f_i_virtual_node_html_a532515f6df4ede5591a4ccc9f9201adc"><div class="ttname"><a href="class_n_f_i_virtual_node.html#a532515f6df4ede5591a4ccc9f9201adc">NFIVirtualNode::NFIVirtualNode</a></div><div class="ttdeci">NFIVirtualNode(const int nVirID)</div><div class="ttdoc">主机IP，此主机的第几个虚节点序号. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:43</div></div>
<div class="ttc" id="class_n_f_c_machine_node_html_afd6171a7c12d33b658a56f5a6e29e5f6"><div class="ttname"><a href="class_n_f_c_machine_node.html#afd6171a7c12d33b658a56f5a6e29e5f6">NFCMachineNode::nPort</a></div><div class="ttdeci">int nPort</div><div class="ttdoc">The port. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:253</div></div>
<div class="ttc" id="class_n_f_c_hasher_html_a3e04172d0f1dd6baf11232b0e583d62a"><div class="ttname"><a href="class_n_f_c_hasher.html#a3e04172d0f1dd6baf11232b0e583d62a">NFCHasher::GetHashValue</a></div><div class="ttdeci">virtual uint32_t GetHashValue(const NFIVirtualNode &amp;vNode)</div><div class="ttdoc">Gets hash value. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:320</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_a427ac1afe315b5ffdfc2c224682feca3"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#a427ac1afe315b5ffdfc2c224682feca3">NFCConsistentHash::GetSuitNode</a></div><div class="ttdeci">bool GetSuitNode(uint32_t hashValue, NFCMachineNode &amp;node)</div><div class="ttdoc">Gets suit node. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:710</div></div>
<div class="ttc" id="class_n_f_c_machine_node_html_a1c637e82822f11a47294b75f1cd21e1f"><div class="ttname"><a href="class_n_f_c_machine_node.html#a1c637e82822f11a47294b75f1cd21e1f">NFCMachineNode::nMachineID</a></div><div class="ttdeci">int nMachineID</div><div class="ttdoc">Identifier for the machine. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:257</div></div>
<div class="ttc" id="class_n_f_i_virtual_node_html_a56adb0a73e6fc4882a653f8e19b66d53"><div class="ttname"><a href="class_n_f_i_virtual_node.html#a56adb0a73e6fc4882a653f8e19b66d53">NFIVirtualNode::NFIVirtualNode</a></div><div class="ttdeci">NFIVirtualNode()</div><div class="ttdoc">Default constructor. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:58</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_a3a78b0fda61127b1007ee7294c0a750d"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#a3a78b0fda61127b1007ee7294c0a750d">NFCConsistentHash::Empty</a></div><div class="ttdeci">bool Empty() const</div><div class="ttdoc">Empties this object. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:564</div></div>
<div class="ttc" id="class_n_f_c_machine_node_html_affba4a0c80decbe4942d7fbd94745a3d"><div class="ttname"><a href="class_n_f_c_machine_node.html#affba4a0c80decbe4942d7fbd94745a3d">NFCMachineNode::nWeight</a></div><div class="ttdeci">int nWeight</div><div class="ttdoc">The weight. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:255</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_af67d2d75ffc7c9762cee876c01f911bf"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#af67d2d75ffc7c9762cee876c01f911bf">NFCConsistentHash::Exist</a></div><div class="ttdeci">bool Exist(const NFCMachineNode &amp;xInNode)</div><div class="ttdoc">Exists the given x coordinate in node. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:626</div></div>
<div class="ttc" id="class_n_f_i_hasher_html"><div class="ttname"><a href="class_n_f_i_hasher.html">NFIHasher</a></div><div class="ttdoc">A nfi hasher. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:274</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_a279954e07e28d128baca8fd7bfc6d8fb"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#a279954e07e28d128baca8fd7bfc6d8fb">NFCConsistentHash::~NFCConsistentHash</a></div><div class="ttdeci">virtual ~NFCConsistentHash()</div><div class="ttdoc">Destructor. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:529</div></div>
<div class="ttc" id="class_n_f_i_virtual_node_html_a986d41eb2eb7968fe5895f0818d248f5"><div class="ttname"><a href="class_n_f_i_virtual_node.html#a986d41eb2eb7968fe5895f0818d248f5">NFIVirtualNode::Candidate</a></div><div class="ttdeci">virtual bool Candidate() const</div><div class="ttdoc">Queries if we candidate. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:120</div></div>
<div class="ttc" id="class_n_f_i_virtual_node_html_a89e93cfe9117bf5d0a300c15e614d0fa"><div class="ttname"><a href="class_n_f_i_virtual_node.html#a89e93cfe9117bf5d0a300c15e614d0fa">NFIVirtualNode::GetDataStr</a></div><div class="ttdeci">virtual std::string GetDataStr() const</div><div class="ttdoc">Gets data string. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:88</div></div>
<div class="ttc" id="class_n_f_i_consistent_hash_html"><div class="ttname"><a href="class_n_f_i_consistent_hash.html">NFIConsistentHash</a></div><div class="ttdoc">A nfi consistent hash. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:342</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_ab81d834827002eea9241c482959ec30b"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#ab81d834827002eea9241c482959ec30b">NFCConsistentHash::Insert</a></div><div class="ttdeci">void Insert(const NFCMachineNode &amp;xNode)</div><div class="ttdoc">Inserts the given x coordinate node. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:603</div></div>
<div class="ttc" id="class_n_f_i_virtual_node_html_a9b3af0cbb1cf10a84873a25cbe89e9ac"><div class="ttname"><a href="class_n_f_i_virtual_node.html#a9b3af0cbb1cf10a84873a25cbe89e9ac">NFIVirtualNode::~NFIVirtualNode</a></div><div class="ttdeci">virtual ~NFIVirtualNode()</div><div class="ttdoc">Destructor. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:72</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_a0fd8f1af6f3d19fe3bfacaf0455e22b4"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#a0fd8f1af6f3d19fe3bfacaf0455e22b4">NFCConsistentHash::GetSuitNode</a></div><div class="ttdeci">bool GetSuitNode(NFCMachineNode &amp;node)</div><div class="ttdoc">Gets suit node. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:670</div></div>
<div class="ttc" id="class_n_f_c_machine_node_html"><div class="ttname"><a href="class_n_f_c_machine_node.html">NFCMachineNode</a></div><div class="ttdoc">A nfc machine node. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:158</div></div>
<div class="ttc" id="class_n_f_c_machine_node_html_a5d485e6eaedec0c0cb31c634b69b15e6"><div class="ttname"><a href="class_n_f_c_machine_node.html#a5d485e6eaedec0c0cb31c634b69b15e6">NFCMachineNode::NFCMachineNode</a></div><div class="ttdeci">NFCMachineNode()</div><div class="ttdoc">Default constructor. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:191</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_a4030aed0ad64cc6605310c219443733d"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#a4030aed0ad64cc6605310c219443733d">NFCConsistentHash::Size</a></div><div class="ttdeci">std::size_t Size() const</div><div class="ttdoc">Gets the size. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:548</div></div>
<div class="ttc" id="class_n_f_c_machine_node_html_aee0365d8448b2f3b8679fb090b9b2d69"><div class="ttname"><a href="class_n_f_c_machine_node.html#aee0365d8448b2f3b8679fb090b9b2d69">NFCMachineNode::NFCMachineNode</a></div><div class="ttdeci">NFCMachineNode(const int nVirID)</div><div class="ttdoc">Constructor. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:173</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_abeaf9f92e51921c0979bbb39662a20eb"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#abeaf9f92e51921c0979bbb39662a20eb">NFCConsistentHash::GetSuitNode</a></div><div class="ttdeci">bool GetSuitNode(const std::string &amp;str, NFCMachineNode &amp;node)</div><div class="ttdoc">Gets suit node. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:690</div></div>
<div class="ttc" id="class_n_f_c_consistent_hash_html_aab3ddfdc96a555eae955a728835fe3d6"><div class="ttname"><a href="class_n_f_c_consistent_hash.html#aab3ddfdc96a555eae955a728835fe3d6">NFCConsistentHash::m_pHasher</a></div><div class="ttdeci">NFIHasher * m_pHasher</div><div class="ttdoc">The hasher. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:756</div></div>
<div class="ttc" id="class_n_f_i_virtual_node_html_a2eb3cf5759a4f598137abd590d9398fa"><div class="ttname"><a href="class_n_f_i_virtual_node.html#a2eb3cf5759a4f598137abd590d9398fa">NFIVirtualNode::GetDataID</a></div><div class="ttdeci">virtual int GetDataID() const</div><div class="ttdoc">Gets data identifier. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:104</div></div>
<div class="ttc" id="_n_f_platform_8h_html"><div class="ttname"><a href="_n_f_platform_8h.html">NFPlatform.h</a></div></div>
<div class="ttc" id="class_n_f_c_hasher_html"><div class="ttname"><a href="class_n_f_c_hasher.html">NFCHasher</a></div><div class="ttdoc">A nfc hasher. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:303</div></div>
<div class="ttc" id="class_n_f_c_machine_node_html_a98ef940585ace3ff994ee56d149bcce1"><div class="ttname"><a href="class_n_f_c_machine_node.html#a98ef940585ace3ff994ee56d149bcce1">NFCMachineNode::bCandidate</a></div><div class="ttdeci">bool bCandidate</div><div class="ttdoc">True to candidate. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:259</div></div>
<div class="ttc" id="class_n_f_i_virtual_node_html_aeda1b40afb2f78d6c5cf8c2a1349a41a"><div class="ttname"><a href="class_n_f_i_virtual_node.html#aeda1b40afb2f78d6c5cf8c2a1349a41a">NFIVirtualNode::ToStr</a></div><div class="ttdeci">std::string ToStr() const</div><div class="ttdoc">Converts this object to a string. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:136</div></div>
<div class="ttc" id="class_n_f_c_machine_node_html_adc9f7a10addffbe139e9a4e9c8daa40a"><div class="ttname"><a href="class_n_f_c_machine_node.html#adc9f7a10addffbe139e9a4e9c8daa40a">NFCMachineNode::GetDataID</a></div><div class="ttdeci">virtual int GetDataID() const</div><div class="ttdoc">Gets data identifier. </div><div class="ttdef"><b>Definition:</b> NFCConsistentHash.hpp:229</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
